@using LibraryManagementSystem.BLL.ProjectionModel
@using System.Text.Json
@{
    var books = ViewBag.Books as IEnumerable<BookSelectItem>;
    var booksJson = JsonSerializer.Serialize(books);
    var booksItems = new SelectList(books, "Id", "Title");
}

<div class="container">
    <form asp-action="Borrow" asp-controller="BorrowingTransactions" method="post">
        <label class="col-form-label">Book</label>
        <select name="bookId" id="bookSelect" class="form-select" asp-items="booksItems">
            <option value="@null">---Select Book---</option>
        </select>
        <div id="bookAlert" class="alert alert-danger d-none mt-2" role="alert">
        </div>
        <input id="borrowBtn" class="d-none btn btn-primary mt-2" value="Borrow" type="submit" />
    </form>
</div>

@section Scripts{
    <script>
        const books = @Html.Raw(booksJson)
        $(document).ready(function () {
               $("#bookSelect").on("change", function () {
                   var selectedValue = $(this).val();
                   var selectedBook = books.find(b => b.Id === selectedValue);
                   if(selectedBook){
                       if(selectedBook.IsBorrowed){
                           $("#bookAlert")
                            .removeClass("d-none alert-success")
                            .addClass("alert-danger")
                            .text("This book is already Checked Out!");
                             
                            $("#borrowBtn")
                            .addClass("d-none")
                       }
                       else{
                           $("#bookAlert")
                            .removeClass("d-none alert-danger")
                            .addClass("alert-success")
                            .text("This book is Available.");

                            $("#borrowBtn")
                            .removeClass("d-none")
                       }
                   }else{
                         $("#bookAlert")
                            .removeClass("alert-success alert-danger")
                            .addClass("d-none")

                         $("#borrowBtn")
                           .addClass("d-none")
                   }
                    });
                });
    </script>    
}